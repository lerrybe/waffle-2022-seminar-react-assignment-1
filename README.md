# waffle-2022-seminar-react-assignment-1

## Repository Structure

📁 src
  
  * 📁 api - api 관련 함수 정의
  * 📁 assets - icon, img 등 에셋들
  * 📁 components - 컨테이너, 컴포넌트 모음
  * 📁 constant - 상수 모음
  * 📁 context - context API 관련 provider 모음
  * 📁 data - context의 initial states 정의
  * 📁 hooks - 커스텀 훅 모음
  * 📁 pages - 컨테이너 + 컴포넌트 묶음, 페이지
  * 📁 routes - 라우팅 정리
  * 📁 services - storage, 혹은 저장공간 함수 작성, 후에 redux 관련 로직
  * 📁 styles - global css 초기화
  * 📁 types - 타입 정보 저장
  * 📁 utils - util 함수 모음


### 💡 NOTES
- [O] Pages 리팩토링 (with TS, Css in Js)
- [O] Components 리팩토링 (with TS, Css in Js)
- [O] functions 리팩토링 (with TS, Css in Js)
- [O] APIs 리팩토링 (with TS, Css in Js)
  * 전체 파일 TS + emotion 이용해 리팩토링

  * 적당한 타입 (추론 가능한 부분은 두고, 혼란을 줄 수 있는 부분에 집중해 타입 작성)의 범위 알기

* Modify
- [O] 메뉴 페이지 이동할 때마다 `search`에 빈 문자열이 들어간 쓸데없는 요청이 날아간다.
  * 중복된 코드가 있어 제거해줬습니다. 
- [O] 가게 검색, 쓰로틀링
  * URL 주소를 올바르게 써주니까 해결됐습니다..! 또 쓰로틀링은 커스텀 훅을 참고했습니다. 다만 input으로 값을 변경하는 전반적인 부분에서 일어나는 문제가 있었는데, setState 비동기 작동 때문에 한 템포 느리게 값이 업데이트 됩니다. 프롭스를 내려주고 받는 과정, 동작 원리에 대한 깊은 이해가 없다고 판단해서 공부할 예정입니다 :! useEffect를 사용한 훅이나 함수형 업데이트를 통해 씽크를 맞춰줄 수 있겠다고 생각했는데 아직 잡지 못했습니다 :( 기본이 되는 기초적인 부분이라 생각해 깊게 보고싶습니다..! 열공.. 열공.. + 초반에 구조를 잘못 잡았는지, API 함수 다는 걸 고려못하고 얼기설기 짰더니 스노우볼이 굉장히 커졌습니다.. 흐름은 단방향으로, (혹은 전역 상태 관리를 사용해 독립적일 수 있게, 역행 X) 자주 쓰는 것들은 함수로 빼두거나 논리를 묶어둬야겠다고 생각했습니다. 
- [O] 무한 스크롤 
  * Intersection observer 이용해 구현했고, 리뷰 배열의 가장 하단에 있는 리뷰가 (div) inView 상태, 눈에 보이는 상태가 되면 api 호출 함수를 부르는 간단한 로직입니다. 컴포넌트 `components/menu-reviews`에 구현되어 있습니다. 
- [O] 설명이나 이미지가 안 들어갈 때 400 오류, 모달 띄우기
  * toastify 실패 모달을 빼버려서 유저입장에서는 어떤 에러인지 알기 어려웠을 것 같습니다..! 모달 달고 상태 코드로 일부분 분류해 조금 개선하고자 했습니다.
- [O] 메뉴를 추가할 때 이미지나 설명이 없는 경우 `undefined`를 넣거나 아무것도 안 넣고 보내주셔야 합니다.
  * 값이 null인지, undefined 상태인지, 혹은 실제 값 (string or number or ...)을 가지고 있는지 타입스크립트 리팩토링 전까지는 날 서게 보지 않아서인지 예상과 다르게 들어가는 값들이 꽤나 많았던 것 같습니다. 독스나 함수 시그니처를 잘 봐야겠다고 생각했습니다.  
- [O] 요청은 언제나 실패할 가능성이 있습니다. 반드시 적절한 처리를 해주시기 바랍니다.
  * 특히 권한과 관련된 요청, 그에 따른 응답과 실패가 좀 어려웠던 것 같은데 방어적으로, 적절하게 안전하게 처리해야겠다고 더욱 느꼈던 것 같습니다.. AuthWrapper 등을 통해 로그인 된 유저만 접근 가능하도록 감싸줘도 좋을 것 같고 새로고침에도 안전하게 페이지단..? 혹은 컨테이너에서 요청을 보내는 방법이 적지 않구나 하고 알게되었습니다. 
- [O] 메뉴가 생성/수정된 직후에 TypeError가 뜨면서 리다이렉트가 안 됩니다.

* New
- [O] **refresh_token을 이용한 자동 로그인을 구현합니다.**
- [O] **access_token 및 패스워드를 리액트 외의 장소(쿠키, localStorage 등)에 따로 저장하지 않음
React가 초기화될 때 POST /auth/refresh를 통해 access_token 갱신을 시도, 실패하는 경우 로그인 되지 않은 상태로
로그인 외의 다른 API 요청들의 경우, 액세스 토큰 만료로 인해 401 오류가 발생->액세스 토큰을 갱신, 해당 요청을 다시 시도
토큰 갱신 실패 경우에만 오류 메시지 사용자에게 보여주기, 토큰 갱신이 잘 되면 사용자는 401로 실패한 사실을 몰라도 됨.**


### remains
* 검색
    - [ ] 메뉴를 타입과 최소 별점으로 필터링하는 기능 구현 (현 - UI)
    - [ ] setState 비동기 버그 해결


## notes
* React 세미나-4 과제
* Typescript와 CSS-in-JS를 이용해 구현한 와플 메뉴 관리 프로그램입니다.
* 배포 URL: https://d2dqgv84eka501.cloudfront.net/ 


### PR 내용
검색 기능 쪽에서 많이 헤맸는데, store와 menuList 검색어 입력하고 결과 받아오는 과정에서 setState 비동기 때문에 어려움을 겪었던 것 같습니다. 중원님 레포에 있는 useEffect 사용한 훅 참고해서 잡아주거나 함수형 업데이트 이용해서 해결할 수 있다고 생각했는데 아직 잡지 못해서.. setState 동작 원리에서 빵꾸가 있는 것 같아 그 부분을 보고 있습니다 ㅠ..! 😨🤯 
이번에 API 들어갈 때 기존에 있던 걸 충분히 리팩토링 하지 않은 채 덮어씌운 느낌이라 과제를 진행하면서 눈덩이처럼 불어나는 게 느껴졌습니다..ㅠ 그래서 예상치 못한 곳에서 동작을 하지 않거나 값이 잘못 들어가는 경우가 종종 (많이) 있었던 것 같아 스노우볼 잘 굴려야겠다고 생각했어요.. 레포 열어주셨으니 많이 참고해 공부하겠습니다! 매번 스파게티 코드 (혹은 구현사항) 읽으시고 피드백 주셔서 정말 감사드립니다..! 
